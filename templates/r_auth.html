<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/application.css">
  <title>Психологи онлайн на MindHelp</title>
</head>

<body>
  <div class="page">
    <!-- Header Section -->
    <header class="header">
      <div class="container">
        <div class="row">
          <div class="col-auto">
            <a href="/" class="logo"><img src="imgs/logo.svg" alt="Logo"></a>
          </div>
          <nav class="navbar">
            <ul class="nav">
              <li><a href="/tests">Психологические тесты</a></li>
              <li><a href="/auth">Вход</a></li>
            </ul>
          </nav>
        </div>
      </div>
    </header>

    <div class="container">
      <h2 class="title">Получить консультацию</h2>

      <div id="loginForm" class="form-card">
        <h4>Вход</h4>
        <form method="POST" action="/send_code">
          <label for="phone">Номер телефона</label>
          <input type="text" id="phone" name="phone" placeholder="Введите номер телефона" required>
          <button type="submit" class="btn">Выслать код</button>
        </form>
      </div>

      <div id="verifyForm" class="form-card" style="display:none;">
        <h4>Введите код</h4>
        <form method="POST" action="/verify_code">
          <input type="text" id="verificationCode" name="verificationCode" placeholder="Введите код (0000)" required>
          <button type="submit" class="btn">Войти</button>
        </form>
      </div>

      <div id="regForm" class="form-card" style="display:none;">
        <h4>Регистрация</h4>
        <form method="POST" action="/register">
          <input type="text" id="name" name="name" placeholder="Имя" required>
          <input type="text" id="phoneReg" name="phone" placeholder="Номер телефона" required>
          <input type="email" id="email" name="email" placeholder="Email" required>
          <button type="submit" class="btn">Зарегистрироваться</button>
        </form>
      </div>

      <p><a href="javascript:void(0)" id="switchToRegister">У меня нет аккаунта, регистрация</a></p>
      <p><a href="javascript:void(0)" id="switchToLogin">Уже есть аккаунт? Войти</a></p>
    </div>
  </div>

  <!-- JavaScript Section -->
  <script>
    document.getElementById('loginForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const phone = document.getElementById('phone').value;

      fetch('/send_code', {
        method: 'POST',
        body: new URLSearchParams({ phone: phone }),
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
      })
      .then(response => response.json())
      .then(data => {
        if (data.message) {
          document.getElementById('verifyForm').style.display = 'block';
        } else {
          alert(data.error || "Ошибка при отправке запроса.");
        }
      })
      .catch(error => alert('Произошла ошибка.'));
    });

    document.getElementById('regForm').addEventListener('submit', function(e) {
      e.preventDefault();

      const name = document.getElementById('name').value;
      const phone = document.getElementById('phoneReg').value;
      const email = document.getElementById('email').value;

      fetch('/register', {
        method: 'POST',
        body: new URLSearchParams({ name: name, phone: phone, email: email }),
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
      })
      .then(response => response.json())
      .then(data => {
        if (data.error) {
          alert(data.error);
        } else {
          window.location.href = `/profile?phone=${phone}`;
        }
      })
      .catch(error => alert('Произошла ошибка при регистрации.'));
    });

    document.getElementById('switchToRegister').addEventListener('click', function() {
      document.getElementById('loginForm').style.display = 'none';
      document.getElementById('regForm').style.display = 'block';
    });

    document.getElementById('switchToLogin').addEventListener('click', function() {
      document.getElementById('regForm').style.display = 'none';
      document.getElementById('loginForm').style.display = 'block';
    });
  </script>
</body>
</html>
